<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: system-ui, sans-serif;
            margin: 16px;
            background: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
        }
        .card {
            background: var(--tg-theme-secondary-bg-color);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 16px;
        }
        .row {
            margin-bottom: 8px;
        }
        button {
            width: 100%;
            padding: 12px;
            margin-top: 8px;
            font-size: 16px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }
        .confirm {
            background: #31b545;
            color: white;
        }
        .cancel {
            background: #e5484d;
            color: white;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>

<h2>üçΩ –ù–æ–≤–∞—è –±—Ä–æ–Ω—å</h2>

<!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
<div id="bookings-container"></div>

<!-- –ö–Ω–æ–ø–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è/–æ—Ç–º–µ–Ω—ã (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –≤—ã–±–æ—Ä–∞ –æ–¥–Ω–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è) -->
<div id="buttons" class="hidden">
    <button class="confirm" onclick="confirmBooking()">‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
    <button class="cancel" onclick="cancelBooking()">‚ùå –û—Ç–º–µ–Ω–∏—Ç—å</button>
</div>

<!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ –¥–æ—Å—Ç—É–ø–µ –∑–∞–ø—Ä–µ—â—ë–Ω -->
<div id="access-denied" class="hidden">
    <h2>‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω</h2>
    <p>–û—Ç–∫—Ä—ã—Ç—å –º–∏–Ω–∏–∞–ø–ø –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Telegram —Å —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–º –∞–∫–∫–∞—É–Ω—Ç–æ–º.</p>
</div>

<script>
const tg = Telegram.WebApp;
tg.expand();

// –°–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö chat_id
const allowedChatIds = [438913614]; // –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–∏

// –§—É–Ω–∫—Ü–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ initData –∏–∑ Telegram Web App
function parseInitData(str) {
    const obj = {};
    if(!str) return obj;
    str.split("&").forEach(pair => {
        const [key, value] = pair.split("=");
        obj[key] = decodeURIComponent(value || "");
    });
    return obj;
}

const initData = tg.initData;
const data = parseInitData(initData);

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ initData –∏ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–π chat_id

    // –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω ‚Äî –∑–∞–≥—Ä—É–∂–∞–µ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞
    fetch("https://your-bot-server.com/get_bookings", { // <-- —Ç—É—Ç URL –±–æ—Ç–∞
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({chat_id: Number(data['chat.id'])})
    })
    .then(res => res.json())
    .then(bookings => {
        if(bookings.error){
            document.body.innerHTML = "<h2>‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω</h2>";
            tg.close();
            return;
        }

        const container = document.getElementById("bookings-container");

        bookings.forEach(b => {
            const card = document.createElement("div");
            card.className = "card";
            card.innerHTML = `
                <div class="row"><b>–ò–º—è:</b> ${b.first_name} ${b.last_name}</div>
                <div class="row"><b>–¢–µ–ª–µ—Ñ–æ–Ω:</b> ${b.phone}</div>
                <div class="row"><b>–ì–æ—Å—Ç–µ–π:</b> ${b.guests}</div>
                <div class="row"><b>–ó–∞–ª:</b> ${b.hall}</div>
                <div class="row"><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:</b> ${b.comments}</div>
                <div class="row"><b>–°–æ–∑–¥–∞–Ω–æ:</b> ${b.created_at}</div>
            `;
            container.appendChild(card);
        });

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        document.getElementById("buttons").classList.remove("hidden");
    })
    .catch(err => {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π:", err);
        document.body.innerHTML = "<h2>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</h2>";
    });


// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
function confirmBooking() {
    alert("–ë—Ä–æ–Ω—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ (–ø–æ–∫–∞ –º–æ–∫)");
    tg.close();
}

function cancelBooking() {
    alert("–ë—Ä–æ–Ω—å –æ—Ç–º–µ–Ω–µ–Ω–∞ (–ø–æ–∫–∞ –º–æ–∫)");
    tg.close();
}
</script>

</body>
</html>
